var fs = require('fs'),
    path = require('path'),
    U = require('underscore')
;
var Generator = module.exports = function(source, destination, options) {
  options || (options = {});
  Generator.processFolder(source, destination, options);
};

U.extend(Generator, {
  extension: '.jst',

  processFolder: function(source, destination, options) {
    options || (options = {});
    fs.readdirSync(source).forEach(function(file) {
      var filePath = path.join(source, file);
      var stat = fs.statSync(filePath);
      if (stat.isFile() && path.extname(file) === Generator.extension) {
        Generator.processFile(filePath, destination, options);
      } else if (stat.isDirectory()) {
        var folderPath = path.join(destination, file);
        fs.mkdirSync(folderPath);
        Generator.processFolder(path.join(source, file), folderPath, options);
      }
    });
  },

  processFile: function(source, destination, options) {
    options || (options = {});
    var file = fs.readFileSync(source).toString();
    console.log(file);
    var template = U.template(file);
    var filename = path.basename(source, Generator.extension);
    fs.writeFileSync(path.join(destination, filename), template(options));
  }
});